# Configuration Zabbix Agent 2 pour Mamie Henrriette Bot

# Serveur Zabbix
Server=zabbix-server.example.com
ServerActive=zabbix-server.example.com:10051

# Configuration de l'agent
Hostname=mamie-henrriette-bot
ListenPort=10050
ListenIP=0.0.0.0

# Logs
LogType=console
LogLevel=3
DebugLevel=3

# Timeout
Timeout=30

# Métriques personnalisées pour le bot Discord
UserParameter=discord.bot.status,python3 /app/bot_status.py
UserParameter=discord.bot.uptime,cat /proc/uptime | awk '{print $1}'
UserParameter=discord.bot.memory,ps -o pid,vsz,rss,comm -p $(pgrep -f bot.py) | tail -1 | awk '{print $3}'

# Surveillance des logs
UserParameter=discord.bot.errors,grep -c "ERROR" /var/log/discord-bot.log 2>/dev/null || echo 0
UserParameter=discord.bot.warnings,grep -c "WARNING" /var/log/discord-bot.log 2>/dev/null || echo 0

# Vérification de la connectivité Discord
UserParameter=discord.connectivity,timeout 5 curl -s https://discord.com/api/v10/gateway >/dev/null && echo 1 || echo 0