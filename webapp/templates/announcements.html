{% extends "template.html" %}

{% block content %}
<div class="space-y-8">
	<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
		<div class="flex items-center gap-3 mb-4">
			<div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
				<svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
				</svg>
			</div>
			<div>
				<h1 class="text-2xl font-bold text-gray-900 dark:text-white">Annonces Twitch</h1>
				<p class="text-gray-600 dark:text-gray-400">Messages automatiques périodiques dans le chat</p>
			</div>
		</div>
		<p class="text-sm text-gray-500 dark:text-gray-400">
			Configurez des messages envoyés automatiquement dans le chat Twitch.
			L'annonce est envoyée uniquement si le temps est écoulé ET si le nombre minimum de messages a été atteint.
		</p>
	</div>

	{% if not announcement %}
	<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
		<div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
			<h2 class="text-lg font-semibold text-gray-900 dark:text-white">Annonces configurées</h2>
		</div>
		
		{% if announcements %}
		<div class="overflow-x-auto">
			<table class="w-full">
				<thead class="bg-gray-50 dark:bg-gray-700/50">
					<tr>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nom</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Message</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Temps</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Min. messages</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Dernier envoi</th>
						<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
					</tr>
				</thead>
				<tbody class="divide-y divide-gray-200 dark:divide-gray-700">
					{% for ann in announcements %}
					<tr class="hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
						<td class="px-6 py-4">
							<span class="font-medium text-gray-900 dark:text-white">{{ ann.name }}</span>
						</td>
						<td class="px-6 py-4">
							<span class="text-gray-600 dark:text-gray-300 text-sm max-w-xs truncate block">{{ ann.text[:60] }}{% if ann.text|length > 60 %}...{% endif %}</span>
						</td>
						<td class="px-6 py-4">
							<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">
								{{ ann.periodicity }} min
							</span>
						</td>
						<td class="px-6 py-4">
							<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
								{{ ann.min_chat_messages }}
							</span>
						</td>
						<td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">
							{% if ann.last_sent %}
								{{ ann.last_sent.strftime('%d/%m %H:%M') }}
							{% else %}
								<span class="italic">Jamais</span>
							{% endif %}
						</td>
						<td class="px-6 py-4 text-right">
							<div class="flex items-center justify-end gap-2">
								<a href="{{ url_for('toggleAnnouncement', id=ann.id) }}" 
								   class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
								   title="{{ 'Désactiver' if ann.enable else 'Activer' }}">
									{% if ann.enable %}
										<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
										</svg>
									{% else %}
										<svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
										</svg>
									{% endif %}
								</a>
								<a href="{{ url_for('resetAnnouncement', id=ann.id) }}" 
								   class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
								   title="Remettre le compteur à zéro">
									<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
									</svg>
								</a>
								<a href="{{ url_for('openEditAnnouncement', id=ann.id) }}" 
								   class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
								   title="Modifier">
									<svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
									</svg>
								</a>
								<a href="{{ url_for('delAnnouncement', id=ann.id) }}" 
								   onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette annonce ?')"
								   class="p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors"
								   title="Supprimer">
									<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
									</svg>
								</a>
							</div>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="px-6 py-12 text-center">
			<svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
			</svg>
			<h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-white">Aucune annonce</h3>
			<p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Commencez par créer votre première annonce automatique.</p>
		</div>
		{% endif %}
	</div>
	{% endif %}

	<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
		<h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">
			{{ 'Modifier l\'annonce' if announcement else 'Ajouter une annonce' }}
		</h2>
		
		<form action="{{ url_for('submitEditAnnouncement', id=announcement.id) if announcement else url_for('addAnnouncement') }}" method="POST" class="space-y-6">
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
				<div>
					<label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Nom de l'annonce
					</label>
					<input type="text" name="name" id="name" required maxlength="64"
						   value="{{ announcement.name if announcement else '' }}"
						   placeholder="Ex: Règles du chat"
						   class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors">
				</div>
				
				<div>
					<label for="periodicity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Temps entre les annonces (minutes)
					</label>
					<input type="number" name="periodicity" id="periodicity" required min="1" max="1440"
						   value="{{ announcement.periodicity if announcement else 10 }}"
						   class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors">
					<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">1 min à 1440 min (24h)</p>
				</div>

				<div>
					<label for="min_chat_messages" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Messages minimum entre annonces
					</label>
					<input type="number" name="min_chat_messages" id="min_chat_messages" required min="0" max="1000"
						   value="{{ announcement.min_chat_messages if announcement else 0 }}"
						   class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors">
					<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">0 = pas de minimum</p>
				</div>
			</div>
			
			<div>
				<label for="text" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
					Message
				</label>
				<textarea name="text" id="text" required maxlength="500" rows="4"
						  placeholder="Le message qui sera envoyé dans le chat..."
						  class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none">{{ announcement.text if announcement else '' }}</textarea>
				<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Maximum 500 caractères</p>
			</div>
			
			<div class="flex items-center gap-4">
				<button type="submit" 
						class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors focus:ring-2 focus:ring-purple-500 focus:ring-offset-2">
					{{ 'Enregistrer' if announcement else 'Ajouter' }}
				</button>
				{% if announcement %}
				<a href="{{ url_for('openAnnouncements') }}" 
				   class="px-6 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg transition-colors">
					Annuler
				</a>
				{% endif %}
			</div>
		</form>
	</div>

</div>
{% endblock %}
